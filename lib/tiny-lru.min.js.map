{"version":3,"sources":["tiny-lru.js"],"names":["global","factory","max","ttl","isNaN","TypeError","LRU","constructor","first","items","last","size","has","key","clear","delete","item","prev","next","evict","get","result","expiry","Date","getTime","value","set","keys","Object","bypass","exports","define","amd","lru","module","window"],"mappings":"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","file":"unknown","sourcesContent":["/**\r\n * Tiny LRU cache for Client or Server\r\n *\r\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\r\n * @copyright 2019\r\n * @license BSD-3-Clause\r\n * @version 6.0.1\r\n */\r\n\r\n\r\n(function (global) {\r\n\r\n\tclass LRU {\r\n\t\tconstructor (max = 0, ttl = 0) {\r\n\t\t\tthis.first = null;\r\n\t\t\tthis.items = {};\r\n\t\t\tthis.last = null;\r\n\t\t\tthis.max = max;\r\n\t\t\tthis.size = 0;\r\n\t\t\tthis.ttl = ttl;\r\n\t\t}\r\n\r\n\t\thas (key) {\r\n\t\t\treturn key in this.items;\r\n\t\t}\r\n\r\n\t\tclear () {\r\n\t\t\tthis.first = null;\r\n\t\t\tthis.items = {};\r\n\t\t\tthis.last = null;\r\n\t\t\tthis.size = 0;\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tdelete (key) {\r\n\t\t\tif (this.has(key)) {\r\n\t\t\t\tconst item = this.items[key];\r\n\r\n\t\t\t\tdelete this.items[key];\r\n\t\t\t\tthis.size--;\r\n\r\n\t\t\t\tif (item.prev !== null) {\r\n\t\t\t\t\titem.prev.next = item.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (item.next !== null) {\r\n\t\t\t\t\titem.next.prev = item.prev;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.first === item) {\r\n\t\t\t\t\tthis.first = item.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.last === item) {\r\n\t\t\t\t\tthis.last = item.prev;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tevict () {\r\n\t\t\tconst item = this.first;\r\n\r\n\t\t\tdelete this.items[item.key];\r\n\t\t\tthis.first = item.next;\r\n\t\t\tthis.first.prev = null;\r\n\t\t\tthis.size--;\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tget (key) {\r\n\t\t\tlet result;\r\n\r\n\t\t\tif (this.has(key)) {\r\n\t\t\t\tconst item = this.items[key];\r\n\r\n\t\t\t\tif (this.ttl > 0 && item.expiry <= new Date().getTime()) {\r\n\t\t\t\t\tthis.delete(key);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult = item.value;\r\n\t\t\t\t\tthis.set(key, result, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tkeys () {\r\n\t\t\treturn Object.keys(this.items);\r\n\t\t}\r\n\r\n\t\tset (key, value, bypass = false) {\r\n\t\t\tlet item;\r\n\r\n\t\t\tif (bypass || this.has(key)) {\r\n\t\t\t\titem = this.items[key];\r\n\t\t\t\titem.value = value;\r\n\r\n\t\t\t\tif (this.last !== item) {\r\n\t\t\t\t\tconst last = this.last,\r\n\t\t\t\t\t\tnext = item.next,\r\n\t\t\t\t\t\tprev = item.prev;\r\n\r\n\t\t\t\t\tif (this.first === item) {\r\n\t\t\t\t\t\tthis.first = item.next;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\titem.next = null;\r\n\t\t\t\t\titem.prev = this.last;\r\n\t\t\t\t\tlast.next = item;\r\n\r\n\t\t\t\t\tif (prev !== null) {\r\n\t\t\t\t\t\tprev.next = next;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (next !== null) {\r\n\t\t\t\t\t\tnext.prev = prev;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this.max > 0 && this.size === this.max) {\r\n\t\t\t\t\tthis.evict();\r\n\t\t\t\t}\r\n\r\n\t\t\t\titem = this.items[key] = {\r\n\t\t\t\t\texpiry: this.ttl > 0 ? new Date().getTime() + this.ttl : this.ttl,\r\n\t\t\t\t\tkey: key,\r\n\t\t\t\t\tprev: this.last,\r\n\t\t\t\t\tnext: null,\r\n\t\t\t\t\tvalue\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (++this.size === 1) {\r\n\t\t\t\t\tthis.first = item;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.last.next = item;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.last = item;\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction factory (max = 1000, ttl = 0) {\r\n\t\tif (isNaN(max) || max < 0) {\r\n\t\t\tthrow new TypeError(\"Invalid max value\");\r\n\t\t}\r\n\r\n\t\tif (isNaN(ttl) || ttl < 0) {\r\n\t\t\tthrow new TypeError(\"Invalid ttl value\");\r\n\t\t}\r\n\r\n\t\treturn new LRU(max, ttl);\r\n\t}\r\n\r\n\t// Node, AMD & window supported\r\n\tif (typeof exports !== \"undefined\") {\r\n\t\tmodule.exports = factory;\r\n\t} else if (typeof define === \"function\" && define.amd !== void 0) {\r\n\t\tdefine(() => factory);\r\n\t} else {\r\n\t\tglobal.lru = factory;\r\n\t}\r\n}(typeof window !== \"undefined\" ? window : global));\r\n"]}